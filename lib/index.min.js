"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Arguments{constructor(a){this._=[],this.__=[],this.argv=new Map,this._options=a;var b=a.alias;for(let c in b)for(let a of b[c])this._options.alias[a]=Array.from(new Set([].concat([c],b[c])).values())}setFlag(b,c,a=null,d=!1){if((!this._options.unknown||this._options.defined(b,c,d)||this._options.unknown(a))&&(c=this._options.parse(b,c,d),this.argv.has(b)||this.argv.set(b,[]),this.argv.get(b).push(c),b in this._options.alias))for(let d of this._options.alias[b])this.argv.has(b)&&this.argv.set(d,[]),this.argv.get(d).push(c)}addPositional(a,b){(b||!this._options.unknown||this._options.unknown(a))&&(b?this.__:this._).push(a)}export(){var a={_:this._};for(let b in this.__&&0<this.__.length&&(a["--"]=this.__),this._options.default||[])this.argv.has(b)||this.setFlag(b,this._options.default[b]);for(let a of this._options.boolean||[])this.argv.has(a)||this.setFlag(a,this._options.default&&a in this._options.default&&this._options.default[a]);return 0<this._options.version&&(a.length=this.argv.size),this.argv.forEach((b,c)=>setDepth(a,c,1==b.length?b[0]:b)),a}}function setDepth(a,b,c){for(var d=b.split("."),e=d.length-1,f=0;f<e;f++)d[f]in a||(a[d[f]]={}),a=a[d[f]];a[d[e]]=c}class ParseOptions{constructor(b=null){if(this["--"]=!1,this.default={},this.string=[],this.boolean=[],this.alias={},this.stopEarly=!1,this.secondPosition=!1,this.unknown=null,this.version=0,this.doubleFlagToBoolean=!1,this.defaultTypes=new Map,this.matchesType=new Map,this.types=new Map,null!=b){for(var c in this.default=b.default||[],this.string=[].concat(b.string||[]),[].concat(b.string||[]).forEach((a)=>{this.types.set(a,(a)=>a+""),this.matchesType.set(a,()=>!0),this.defaultTypes.set(a,"")}),"boolean"==typeof b.boolean&&!0==b.boolean?this.doubleFlagToBoolean=!0:(this.boolean=[].concat(b.boolean||[]),[].concat(b.boolean||[]).forEach((a)=>{this.types.set(a+"",(a)=>!0==a||"true"==a),this.matchesType.set(a,(a,b)=>"true"==b||"false"==b),this.defaultTypes.set(a,!0)})),this.alias=b.alias||this.alias,this.alias)this.alias[c]=[].concat(this.alias[c]);this.stopEarly=b.stopEarly,this.secondPosition=b["--"]||this["--"],this.unknown=b.unknown||this.unknown,this.version=b.version||this.version}}parse(a,b,c=!1){if(null==b)return null;if(null!=a&&this.types.has(a))return this.types.get(a)(b);if(null!=a&&a in this.alias){var d=this.alias[a].find((a)=>this.types.has(a));if(d)return this.types.get(d)(b)}return c&&this.doubleFlagToBoolean?"true"==b||"false"==b?"true"==b:b:isNumber(b)?+b:b}defined(a,b,c=!1){return this.doubleFlagToBoolean&&c&&!0==b||this.types.has(a)||null!=a&&a in this.alias&&0<this.alias[a].length}matches_type(a,b,c=!1){return this.doubleFlagToBoolean||0!=this.matchesType.size||a.startsWith("no-")?this.doubleFlagToBoolean&&c&&"true"!=b&&"false"!=b?!1:this.matchesType.has(a)?this.matchesType.get(a)(a,b):a in this.alias&&0<this.alias[a].filter((a)=>this.matchesType.has(a)).length?a in this.alias&&0<this.alias[a].filter((a)=>this.matchesType.has(a)).filter((a)=>this.matchesType.get(a)(a,b)).length:!0:!0}defaultValue(a){if(null!=a&&this.matchesType.has(a))return this.defaultTypes.get(a);if(null!=a&&a in this.alias){var b=this.alias[a].find((a)=>this.types.has(a));if(b)return this.defaultTypes.get(b)}return!0}}exports.ParseOptions=ParseOptions;function isInt(a){var b;return!isNaN(a)&&(b=parseFloat(a),(0|b)===b)}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function parse(a,b=new ParseOptions){b=new ParseOptions(b);let c=new Arguments(b),d=!0;a=[].concat(a).map((b)=>b+"");for(let e,f=0;f<a.length;f++){if(e=a[f],d&&1<e.length)if(e.startsWith("--")){if("--"==e){d=!1;continue}if(-1<e.indexOf("=")){let a=e.split("=");c.setFlag(a[0].substr(2),a[1],e,!0)}else f+1<a.length&&("-"==a[f+1]||!a[f+1].startsWith("-"))&&b.matches_type(e.substr(2),a[f+1],!0)?(c.setFlag(e.substr(2),a[f+1],e,!0),f++):e.startsWith("--no-")?c.setFlag(e.substr(5),!1,e):c.setFlag(e.substr(2),b.defaultValue(e.substr(2)),e,!0);continue}else if(e.startsWith("-")){if(2==e.length&&f+1<a.length&&("-"==a[f+1]||!a[f+1].startsWith("-"))&&b.matches_type(e.substr(1),a[f+1]))c.setFlag(e.substr(1),a[f+1],e),f++;else for(let d=1;d<e.length;d++)if(!isNumber(e[1])&&d+1<e.length&&/[^a-zA-Z=]+/.test(e[d+1])){c.setFlag(e.substr(d,1),e.substr(d+1),"-"+e.substr(d,1));break}else if(d+1<e.length&&-1<e[d+1].indexOf("=")){c.setFlag(e.substr(d,1),e.substr(d+2),"-"+e.substr(d,1));break}else if(d+1==e.length&&f+1<a.length&&("-"==a[f+1]||!a[f+1].startsWith("-"))&&b.matches_type(e.substr(1),a[f+1])){c.setFlag(e[d],a[f+1],"-"+e[d]),f++;break}else c.setFlag(e[d],b.defaultValue(e[d]),"-"+e[d]);continue}b.stopEarly&&(d=!1),c.addPositional(b.parse(null,e),!d&&b.secondPosition)}return c.export()}exports.default=parse,module.exports=parse,module.exports.ParseOptions=ParseOptions;